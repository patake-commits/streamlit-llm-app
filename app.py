import streamlit as st

from langchain_community.chat_models import ChatOpenAI
from langchain.schema import SystemMessage, HumanMessage

# OpenAI APIã‚­ãƒ¼
import os
openai_api_key = os.getenv("OPENAI_API_KEY")  # 

# LLM åˆæœŸåŒ–ï¼ˆgpt-3.5-turboï¼‰
llm = ChatOpenAI(temperature=0.7, model="gpt-3.5-turbo", openai_api_key=openai_api_key)

# ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå®šç¾©
system_prompts = {
    "æ „é¤Šã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼": "ã‚ãªãŸã¯çµŒé¨“è±Šå¯Œãªæ „é¤Šã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ã§ã™ã€‚å¹´é½¢ãƒ»æ€§åˆ¥ãƒ»ç”Ÿæ´»ç¿’æ…£ã«å¿œã˜ã¦ã€å¥åº·çš„ãªé£Ÿäº‹ã‚„æ „é¤Šãƒãƒ©ãƒ³ã‚¹ã«ã¤ã„ã¦åˆ†ã‹ã‚Šã‚„ã™ãã‚¢ãƒ‰ãƒã‚¤ã‚¹ã—ã¦ãã ã•ã„ã€‚å°‚é–€ç”¨èªã¯ä½¿ã„ã™ããšã€æ—¥å¸¸ç”Ÿæ´»ã«å–ã‚Šå…¥ã‚Œã‚„ã™ã„å…·ä½“çš„ãªææ¡ˆã‚’è¡Œã£ã¦ãã ã•ã„ã€‚",
    "ç¡çœ ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ": "ã‚ãªãŸã¯ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªç¡çœ ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç”Ÿæ´»ãƒªã‚ºãƒ ã‚„æ‚©ã¿ã«åˆã‚ã›ã¦ã€ã‚ˆã‚Šè‰¯ã„ç¡çœ ç’°å¢ƒã‚„ç¿’æ…£ã®æ•´ãˆæ–¹ã‚’å„ªã—ãä¸å¯§ã«ææ¡ˆã—ã¦ãã ã•ã„ã€‚åŒ»ç™‚è¡Œç‚ºã¯é¿ã‘ã€ç”Ÿæ´»æ”¹å–„ã®è¦–ç‚¹ã§ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚",
    "ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼": "ã‚ãªãŸã¯ä¿¡é ¼ã§ãã‚‹ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã§ã™ã€‚é‹å‹•ç¿’æ…£ã‚’èº«ã«ã¤ã‘ãŸã„äººã«å¯¾ã—ã¦ã€ç›®çš„ã‚„ä½“åŠ›ã«å¿œã˜ãŸãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚„ã‚¹ãƒˆãƒ¬ãƒƒãƒã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚åˆå¿ƒè€…ã«ã‚‚åˆ†ã‹ã‚Šã‚„ã™ãã€å®‰å…¨ã‚’ç¬¬ä¸€ã«è€ƒãˆãŸæŒ‡å°ã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚",
}

# å›ç­”ç”Ÿæˆé–¢æ•°
def generate_response(user_input, expert_type):
    system_message = SystemMessage(content=system_prompts[expert_type])
    human_message = HumanMessage(content=user_input)
    response = llm([system_message, human_message])
    return response.content

# ç”»é¢æ§‹æˆ
st.set_page_config(page_title="ç”Ÿæ´»æ”¹å–„ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼", layout="centered")

st.title("ğŸ§  ç”Ÿæ´»æ”¹å–„ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼")
st.markdown("""
ã“ã®ã‚¢ãƒ—ãƒªã§ã¯ã€3ã¤ã®å°‚é–€å®¶ï¼ˆæ „é¤Šã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ãƒ»ç¡çœ ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆãƒ»ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ï¼‰ã®çŸ¥è­˜ã‚’æ´»ç”¨ã—ã¦ã€
ã‚ãªãŸã®ç”Ÿæ´»æ”¹å–„ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚è³ªå•ã‚’å…¥åŠ›ã—ã¦é€ä¿¡ã™ã‚‹ã¨ã€å°‚é–€å®¶ã‹ã‚‰ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒè¿”ã£ã¦ãã¾ã™ã€‚
""")

# å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
with st.form(key="chat_form"):
    user_input = st.text_area("ã”ç›¸è«‡å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", height=150)
    expert_type = st.radio(
        "å°‚é–€å®¶ã®ç¨®é¡ã‚’é¸ã‚“ã§ãã ã•ã„",
        options=["æ „é¤Šã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼", "ç¡çœ ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ", "ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼"],
        index=0
    )
    submit_btn = st.form_submit_button("é€ä¿¡")

# å¿œç­”è¡¨ç¤º
if submit_btn and user_input:
    with st.spinner("ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ç”Ÿæˆä¸­..."):
        response = generate_response(user_input, expert_type)
        st.success("âœ… ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¯ã“ã¡ã‚‰ã§ã™")
        st.markdown(response)
